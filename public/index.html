<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Canvas Fractals</title>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <style type="text/css" media="all" xml:space="preserve"> 
    /*<![CDATA[*/
        body {
            background: #000;
        }
        canvas {
            background: #fff;
        }
    /*]]>*/
    </style>
    <script type="application/javascript">
    /*<![CDATA[*/

//
// prepare the canvas for subsequent drawing
//
// canvas: the html5 canvas element
// ctx: the canvas 2d drawing context
// config: object with configuration properties
//
var init = function(canvas, ctx, config) {
    if (config.width) {
        canvas.width = config.width;
    }
    if (config.height) {
        canvas.height = config.height;
    }
    if (config.background) {
        ctx.fillStyle = config.background;
    }
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.translate(canvas.width * config.tx, canvas.height * config.ty);
};

//
// draw one instance of the basic shape
//
// ctx: the canvas 2d drawing context
// depth: recursion level
// config: object with configuration properties
//
var draw = function(ctx, depth, config) {
    ctx.fillStyle = config.color;
    ctx.fillRect(-config.w/2, 0, config.w, config.h);
};

//
// setup the canvas context transformation for the next level of recursion
//
// ctx: the canvas 2d drawing context
// depth: recursion level
// config: object with configuration properties
//
var transform = function(ctx, depth, config) {
    ctx.translate(-config.w/2, 0);
    ctx.scale(config.ratio, config.ratio);
    ctx.translate(-config.w/2, -config.h);
};

//
// direct the overall recursion of the drawing
//
// ctx: the canvas 2d drawing context
// depth: recursion level
// depthMax: recursion level limit
// config: object with configuration properties
//
var recurse = function(ctx, depth, depthMax, config) {
    if (depth >= depthMax) {
        return;
    }
    
    draw(ctx, depth, config);

    ctx.save();
    transform(ctx, depth, config);
    recurse(ctx, depth + 1, depthMax, config);
    ctx.restore();
};

//
// create recursive image on the canvas
//
// config: object with configuration properties
//
var create = function(config) {
    var canvas = document.getElementsByTagName("canvas")[0];
    var ctx = canvas.getContext("2d");

    init(canvas, ctx, config);

    recurse(ctx, 0, config.depth, config);
};

//
// execute after page load
//
window.onload = function(ev) {
    var config = {
        background: "rgb(59, 185, 255)",
        width: 600,     // canvas width
        height: 500,    // canvas height
        tx: 0.5,        // x origin translation as a fraction of width
        ty: 0.8,        // y origin translation as a fraction of width

        depth: 10,      // recursion limit
        ratio: 1/Math.sqrt(2),     // scale for each step

        w: 100,         // properties of basis image
        h: 100,
        color: "green",
    };

    create(config);
};

    /*]]>*/
    </script>
</head>
<body>
    <div id="container"> 
        <canvas id="canvas" width="512" height="512">
        </canvas>
    </div> 
</body>
</html>